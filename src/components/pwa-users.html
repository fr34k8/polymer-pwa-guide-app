<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="./pwa-user.html">

<dom-module id="pwa-users">
  <template>
    <style>
      :host {
        display: block;
        justify-content: center;
      }

      ul {
        list-style-type: none;
        padding: 0px;
      }

      ul li {
        padding: 10px 10px 0px 10px;
      }

      .user > a {
        text-decoration: none;
      }

      a pwa-user,
      a:hover pwa-user,
      a:link pwa-user,
      a:active pwa-user,
      a:visited pwa-user {
        width: 100%;
        color: #000;
        text-transform: none;
      }

      paper-fab {
        position: fixed;
	      bottom: 20px;
	      right: 20px;
        z-index: 9;
      }

      paper-fab {
        --paper-fab-background: var(--paper-cyan-a700);
        --paper-fab-keyboard-focus-background: var(--paper-cyan-a700);
      }

      paper-dialog {
        width: 100%;
        text-align: left;
      }

      paper-dialog .actions {
        text-align: right;
      }

      paper-dialog .actions paper-button {
        color: var(--paper-cyan-a700);
        font-weight: 800;
      }
    </style>

    <!-- firebase config -->
    <firebase-app
      api-key="AIzaSyBfdmWiLAgIPCN-LADPTQtqD54TWdMzmZk",
      auth-domain="react-pwa-hello-world.firebaseapp.com",
      database-url="https://react-pwa-hello-world.firebaseio.com">
    </firebase-app>

    <!-- firebase query -->
    <firebase-document id="query" path="/users" data="{{users}}"></firebase-document>

    <!-- users list -->
    <ul>
      <template is="dom-repeat" items="{{_toItems(users)}}" as="user">
        <li class="user">
          <a href="">
            <pwa-user user-name="[[user.name]]" user-email="[[user.email]]"></pwa-user>
          </a>
        </li>
      </template>
    </ul>

    <!-- user adding -->
    <paper-dialog id="dialog" with-backdrop>
      <h2>Adding New User</h2>
      <div>
        Input your name and email address.
        <paper-input placeholder="Name" value="{{user.name}}"></paper-input>
        <paper-input placeholder="Email" value="{{user.email}}"></paper-input>
      </div>
      <div class="actions">
        <paper-button on-tap="submit">Submit</paper-button>
      </div>
    </paper-dialog>
    <paper-fab icon="add" on-tap="open"></paper-fab>
  </template>

  <script>
    class PWAUsers extends Polymer.Element {
      static get is() {
        return 'pwa-users';
      }

      constructor() {
        super();

        this.reset();
      }

      _toItems(data) {
        return Object.keys(data).map(key => data[key]);
      }

      reset() {
        this.user = {
          name: '',
          email:''
        };
      }

      submit() {
        if (this.user.name && this.user.email) {
          firebase.app().database().ref('users').push(this.user).then((snapshot) => {
            this.reset();
            this.$.dialog.close();
          })
        }
      }

      open() {
        this.$.dialog.open()
      }
    }

    window.customElements.define(PWAUsers.is, PWAUsers);
  </script>
</dom-module>